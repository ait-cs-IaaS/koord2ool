<template>
  <v-container fluid class="pl-0">
    <v-row>
      Choose a survey
      <v-btn type="primary" @click="refresh">Refresh</v-btn>
      <v-list>
        <v-list-item
          v-for="{ key, label, to } in surveyLinks"
          :key="key"
          :to="to"
        >
          <v-list-item-content>
            {{ label }}
          </v-list-item-content>
        </v-list-item>
      </v-list>
    </v-row>
  </v-container>
</template>

<script lang="ts">
import { defineComponent } from "vue";
import { mapGetters, mapState } from "vuex";

type SurveyLink = {
  key: string | number;
  label: string;
  to: string;
};

export default defineComponent({
  name: "SurveyList",
  props: { username: { type: String, required: true } },

  computed: {
    ...mapState(["surveys"]),
    ...mapGetters(["getSurveys"]),
    surveyLinks(): SurveyLink[] {
      const surveyIds: number[] = [...this.getSurveys];
      return surveyIds.sort().map((surveyId) => {
        const title = this.surveys[surveyId].surveyls_title;
        return {
          key: surveyId,
          label: `${surveyId} - ${title}`,
          to: `/survey/${surveyId.toString()}`,
        };
      });
    },
  },
  methods: {
    async refresh(): Promise<void> {
      await this.$store.dispatch("refreshSurveys");
    },
  },
});
</script>
